---
title: Git
description: 存储模块
published: true
date: 2023-03-16T08:45:000Z
tags: storage, module, 存储, 模块
editor: markdown
dateCreated: 2023-01-08T10:37:11.629Z
---

Git是一种版本控制系统，用于跟踪计算机文件的更改并协调多人在这些文件上的工作。

# 开始使用

可能是存储文档最流行的方法，Git模块可以轻松地与任何远程Git仓库同步。

为了方便起见，下面列出了最流行的Git提供商的说明。然而，该模块应该适用于几乎任何标准的Git提供商。

**您必须在系统上安装Git 2.7.4或更高版本才能启用此模块！**
*docker镜像已经包含了此依赖项。*

*Git存储库必须专门用于Wiki.js。目前无法仅使用子文件夹或子模块。*

# 提供商

## Azure DevOps

*即将上线*

## BitBucket

*即将上线*

## GitHub

[GitHub](https://www.github.com) 是最受欢迎的git版本控制提供商

### 生成一个新密钥

1. 启动终端
2. 键入以下命令：
   ```bash
   ssh-keygen -t rsa -b 4096
	 ```
3. 在提示保存生成的文件时，输入一个Wiki.js可以访问的路径（例如 `/etc/wiki/github.pem`），然后按下 **Enter**。
4. 将密码留空，然后按两次 **Enter**。受密码保护的密钥将无法使用。


> 在Windows上，您可以使用 [Git Bash](https://git-scm.com/download/win) 或Windows下的Linux子系统发行版（例如 [适用于Windows的Ubuntu](https://www.microsoft.com/en-us/p/ubuntu/9nblggh4msv6)）来运行上面的命令。您也可以使用[puttygen](https://www.ssh.com/ssh/putty/download) 手动生成密钥。
{.is-info}

### 将密钥添加到GitHub

1. 创建一个新的GitHub存储库。
1. 点击**设置**选项卡。
1. 点击左侧导航菜单中的**部署密钥**。
1. 点击**添加部署密钥**按钮。
1. 为此密钥输入一个您选择的名称（例如 wiki），并粘贴先前生成的公钥的内容。*(以 .pub 结尾的文件)*
1. 确保勾选**允许写入**。
1. 点击**添加密钥**按钮。

### 配置Wiki.js

1. 在管理区中，点击左侧导航菜单中的**存储**选项。
1. 确保选中**Git**为存储目标。
1. 点击**Git**选项卡。
1. 输入以下设置：
	- 认证类型：`ssh`
  	- 存储库URI：*在您的GitHub存储库页面的**Code**选项卡中，点击**Clone or download**绿色按钮，并复制下方**Clone with SSH**显示的URI。*
  	- 分支：`main`
  	- SSH私钥路径：*之前生成的私钥路径*
  	- 用户名：*留空*
  	- 密码：*留空*
  	- 默认作者E-mail：*应与您的GitHub账户的电子邮箱相匹配。*
  	- 默认作者名：*应与您的GitHub账户名称匹配。*
  	- 本地存储库路径：*选择将存储库克隆到本地的位置，或保留默认值`/data/repo`*
    - 验证SSL证书：**开启**
  
1. 将 **同步方向** 设置为 **双向**。
1. 将 **同步计划** 设置为 **每5分钟**。
1. 点击页面顶部的 **应用更改** 按钮。
1. 等待 **状态** 面板更新。一个新的 Git 条目应该以绿色显示。如果条形图为红色，则意味着您的配置中有错误。返回到Git选项卡，修复错误并重试。
## GitLab

*即将上线*

# 一般情况

## 重要提示

当首次启用Git存储模块并配置一个已有内容的存储库是，您可能需要执行手动倒入。默认情况下，将仅导入本地最新提交和远程最新提交之间的更改。

> **注意！** 在继续下面的步骤之前，请确保Git模块已经配置好并正常工作。
{.is-warning}

要强制导入本地存储库中当前存在的所有内容，请在管理区（“存储”下）加载**Git**模块设置选项卡，滚动到页面底部并单击**导入所有内容**操作卡上的**执行**按钮。

## 远程存储库中缺少内容

如果在启用Git存储模块之前或暂时禁用该模块时，在Wiki.js中创建了内容，则该内容将缺失于远程Git存储库中。

> **注意！** 在继续之前，请确保已经配置并且Git模块正在工作。
{.is-warning}

要解决此问题，请在管理区域（位于“存储”下）加载 **Git** 模块设置选项卡，滑至页面底部，并单击 **添加未跟踪的更改** 操作卡上的 **执行* *按钮。这将强制输出数据库中当前存在的所有内容以便添加到git跟踪文件，并创建一个提交。

请注意，这不会与您的远程仓库同步。您必须等待下一次同步发生或手动使用 **强制同步**操作来强制进行同步。

# 常见问题

## 为什么保存页面时未同步内容？

出于性能原因，默认情况下新提交只会定期同步（每5分钟）。您可以在 Git 存储模块设置中更改计划表。

## 如何强制手动同步？

请在管理区（位于“存储”下）加载 Git 模块设置选项卡，滑至页面底部并单击 强制同步 操作卡上的 执行 按钮。
